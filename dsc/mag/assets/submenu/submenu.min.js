'use strict';

(function () {
    // dev
    // let dir = '';
    // let path = '/tw/dsc/digital-newspaper/1901_index'.split('/');
    // final
    var dir = 'assets/submenu/';
    var path = location.pathname.split('/');
    var id = path[path.length - 1].replace('.html', '');
    var page = path[path.length - 1].replace(/(.html|.htm)/g, '');
    var header = document.querySelector('.header-box header');

    if (header !== null) {
        new Vue({
            el: '#submenu',
            data: {
                results: [],
                currentPage: '',
                isActive: false
            },
            created: function created() {
                header.insertAdjacentHTML('beforeend', '<div id="submenu"></div>');
                this.getData();
            },
            methods: {
                // 取得選單內容
                getData: function getData() {
                    var _this = this;

                    fetch(''.concat(dir, 'submenu.json')).then(function (res) {
                        return res.json();
                    }).then(function (res) {
                        _this.results = res.filter(function (value) {
                            return value.id === id;
                        });
                        _this.isActive = true;
                    });
                },
                // 設定標題文字
                setTitle: function setTitle(value) {
                    return this.currentPage ? ''.concat(value, ' / ').concat(this.currentPage) : value;
                },
                // 判斷連結開啟方式
                linkTo: function linkTo(url, target) {
                    var urlArr = url.split('#');

                    if (urlArr[0] === '' || urlArr[0] === page) {
                        var $target = $('#'.concat(urlArr[1]));

                        if ($target.length) {
                            var targetPos = $target.offset().top;
                            $('html, body').animate({
                                scrollTop: targetPos - 50
                            });
                        }
                    } else if (target) {
                        window.open(url, target);
                    } else {
                        window.open(url, '_self');
                    }
                }
            },
            template: '\n                <div class="page-submenubox" :class="{active:isActive}">\n                    <div class="page-submenu">\n                        <div class="container">\n                            <template v-for="result in results">\n                                <h2>{{setTitle(result.title)}}</h2>\n                                <ul class="page-submenu-list">\n                                    <li v-for="menu in result.menus">\n                                        <span>\n                                            <a :href="menu.url" @click.prevent="linkTo(menu.url, menu.target)">{{menu.text}}</a>\n                                        </span>\n                                    </li>\n                                </ul>\n                            </template>\n                        </div>\n                    </div>\n                </div>\n            '
        });
    }
})();